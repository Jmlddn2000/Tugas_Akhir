import React, { useState } from 'react';
import { kmeans } from 'ml-kmeans';

function CMeansClustering() {
  const [data, setData] = useState([
    {"x":600.9919629480432,"y":294.55414055261474},{"x":541.2957389630751,"y":290.27453382365326},{"x":524.7843144130615,"y":263.00959254796135},{"x":542.1151789338963,"y":293.1967368788556},{"x":504.3669302392581,"y":308.2636639011356},{"x":503.9037765371194,"y":310.91325907518285},{"x":517.6428101442959,"y":334.937111646363},{"x":646.6860327058635,"y":328.69866867986127},{"x":820.2472122756328,"y":304.2144583505401},{"x":868.6872315475387,"y":286.92478371554193},{"x":993.6542589876335,"y":297.6879586174247},{"x":1000.0524636417535,"y":288.87133815892645},{"x":1089.7984138275674,"y":229.15013723650532},{"x":1119.5459411719012,"y":193.28969851484214},{"x":1186.282443092287,"y":160.88835839969573},{"x":1151.3750685428918,"y":151.21710842586248},{"x":1150.426757167634,"y":92.07166338140289},{"x":1135.325200520046,"y":109.3010222758382},{"x":1100.7536173992414,"y":108.69023035204518},{"x":1093.1047308007855,"y":134.89908563793222},{"x":1047.5933915159183,"y":159.03230705044712},{"x":1042.2798206362818,"y":159.77818166104035},{"x":1016.377280637705,"y":238.7680819042203},{"x":850.3806836979096,"y":404.8799490564501},{"x":826.9796818250144,"y":429.0541493082723},{"x":845.132190736746,"y":412.367724888546},{"x":878.6627597588937,"y":388.32281440680356},{"x":836.5762580245234,"y":456.47107598522473},{"x":819.3475544444343,"y":512.9951057770861},{"x":830.0507648494489,"y":483.39908903883855},{"x":841.4862301321142,"y":480.04030200130654},{"x":876.9054490344942,"y":427.22972505207866},{"x":867.666918057387,"y":394.0339931758565},{"x":857.409993291569,"y":449.8855622897772},{"x":884.8851869776415,"y":421.9294022569399},{"x":870.2275167085593,"y":372.5687617796269},{"x":864.4977872217924,"y":337.56718410249806},{"x":861.3823435365881,"y":345.7620224373774},{"x":851.659533118563,"y":316.8600858781099},{"x":890.2499438760841,"y":316.84830840457363},{"x":858.5385134664818,"y":341.24901102671635},{"x":840.9449135312638,"y":382.3071853713735},{"x":712.1412431304411,"y":527.7878020138106},{"x":591.393973675025,"y":630.6789738265959},{"x":550.262785473116,"y":668.5238076184087},{"x":538.6752674898664,"y":682.9916443783762},{"x":468.7607990541261,"y":769.4325117422859},{"x":469.9855922905416,"y":820.3330587346554},{"x":394.87610502638404,"y":840.1241788903006},{"x":497.5864322985568,"y":777.3005901214431},{"x":596.1685964628327,"y":683.6367818494133},{"x":657.1574786578396,"y":619.1408243944272},{"x":680.807444490641,"y":569.6522749485679},{"x":737.8901528211094,"y":519.9830262973829},{"x":798.0140790994086,"y":469.87338944638526},{"x":891.3495533401112,"y":420.03746970432326},{"x":931.8530444804716,"y":355.0263100764745},{"x":942.7661727284076,"y":319.45971653249643},{"x":928.6902285359433,"y":309.31568875235445},{"x":941.1630163050887,"y":259.07196113944934},{"x":947.4073620818192,"y":249.21222164442457},{"x":948.3064041946776,"y":242.62906881423686},{"x":947.8250762891352,"y":243.6829413265298},{"x":935.5097562125706,"y":266.028625898125},{"x":911.084207260889,"y":277.49363726085556},{"x":909.2773781831208,"y":322.67359409007446},{"x":922.5816464494413,"y":295.04005262479114},{"x":937.3371446187851,"y":287.7887053497395},{"x":894.0235590137368,"y":320.27503799511595},{"x":889.3949622408484,"y":296.00057773959793},{"x":909.6050061235717,"y":264.16969747256076},{"x":936.079622887602,"y":290.9638780398863},{"x":888.2139809000867,"y":346.33933748399306},{"x":902.6306765870053,"y":374.9033072438109},{"x":914.1046361987464,"y":371.3121396094213},{"x":935.8790910018215,"y":337.9083443614868},{"x":944.756696770123,"y":320.9941578775286},{"x":979.7611376197633,"y":294.4463801500747},{"x":1009.1647436398085,"y":328.5877532103624},{"x":994.5721588244915,"y":342.24374178999767},{"x":992.5020929461763,"y":347.2392056118486},{"x":958.3577462961048,"y":305.6547735097167},{"x":960.7305963665312,"y":311.06503335137427},{"x":992.4884350222674,"y":321.05997481422736},{"x":965.9709451144614,"y":304.9597493312208},{"x":933.3661569344437,"y":339.48877861647424},{"x":867.8662570524012,"y":352.41190733130844},{"x":821.2951346075527,"y":384.28559335439957},{"x":879.5306526591698,"y":381.3220778896277},{"x":882.6843853498974,"y":390.1543071010805},{"x":887.1818485146101,"y":385.6523545360554},{"x":921.9649992125649,"y":403.80476459635264},{"x":909.8279317539232,"y":422.56664048432026},{"x":895.363048598018,"y":373.580495197602},{"x":914.4914636941822,"y":392.43780975579665},{"x":919.2339261980576,"y":464.4523381937071},{"x":918.4507791449032,"y":470.36676063700276},{"x":893.5381031721056,"y":466.2963208278959},{"x":845.5350808797089,"y":469.8315955433393},{"x":836.9717167651344,"y":449.48812252291407},{"x":848.0435783275661,"y":430.93807545877416},{"x":873.6947767489378,"y":433.7753904635311},{"x":868.7301899685493,"y":439.47961725882084},{"x":908.1259193262623,"y":377.18514802716425},{"x":806.53026693792,"y":375.57394413236483},{"x":824.1220142980007,"y":399.153920066472},{"x":843.0115247448002,"y":424.9375545766423},{"x":874.2845095994461,"y":430.8793915578162},{"x":894.1786955018515,"y":427.0698654885749},{"x":929.20111214158,"y":376.69219017524824},{"x":1005.045033879619,"y":374.51512345806356},{"x":1036.5572341481916,"y":378.07411190688856},{"x":1035.5377442329732,"y":372.3069938398537},{"x":1011.1066646812925,"y":335.4245025456228},{"x":990.9665248960221,"y":311.9000252090649},{"x":984.0875236907326,"y":340.0619200142609},{"x":967.0303484073523,"y":298.02587329182325},{"x":921.9201135566757,"y":288.81944055562064},{"x":952.523414629137,"y":252.3910813814222},{"x":947.5096016282237,"y":228.90932835961863},{"x":926.5221135470745,"y":185.46039391237855},{"x":864.8174066355382,"y":208.93991354079688},{"x":904.1520031638743,"y":189.79871344027472},{"x":917.0267368408951,"y":181.84600520153333},{"x":919.3519891931504,"y":178.7880446136783},{"x":926.8044724072572,"y":177.68819804063594},{"x":904.5151142927871,"y":242.46227366275423},{"x":859.9326009069758,"y":272.49454291765585},{"x":908.2700017809728,"y":272.50943310971184},{"x":916.1592129930948,"y":312.4733373716522},{"x":887.3733322532522,"y":364.5047743891462},{"x":829.6174950994746,"y":358.14825916613125},{"x":789.3440404103566,"y":343.84639364227553},{"x":694.9608348680633,"y":326.8395881731737},{"x":622.582156074199,"y":330.2413485103621},{"x":605.3003495627794,"y":284.9504649294787},{"x":505.7861396118359,"y":320.2573914649757},{"x":478.71123860656843,"y":347.4530339311631},{"x":409.4015711919556,"y":338.0552426205534},{"x":312.304822811809,"y":401.8296440913985},{"x":319.01897804751843,"y":369.4697321969256},{"x":340.2777412284684,"y":311.435955371311},{"x":402.7350959725131,"y":299.6123184490611},{"x":516.9149129958894,"y":276.3376314440705},{"x":631.2964612298077,"y":266.24066107278196},{"x":634.4524263690089,"y":257.97591109751767},{"x":599.5050662922145,"y":310.72403867022956},{"x":581.6265578776354,"y":416.6518940297836},{"x":590.6350077405309,"y":440.0827140932384},{"x":601.2178499958122,"y":451.80975409824526},{"x":588.1948111074687,"y":448.50742143437117},{"x":534.3340033413033,"y":478.59980889511553},{"x":568.5654573420583,"y":469.3763199628196},{"x":602.48140424064,"y":524.3447874373787},{"x":607.4496226472411,"y":549.7776675698799},{"x":619.9587730699207,"y":559.0689687210887},{"x":634.9610495679678,"y":537.2554817310056},{"x":653.5327366103497,"y":504.0996083142205},{"x":724.7224264292431,"y":480.0407554231199},{"x":699.9111598409909,"y":500.07861893573687},{"x":699.2307640811571,"y":484.5550428106418},{"x":688.917256278137,"y":524.8478531193475},{"x":813.5350148683103,"y":566.0669045149197},{"x":906.8963545588372,"y":607.66795438886},{"x":941.3379282475969,"y":644.3008935877803},{"x":1015.6154183274464,"y":640.3539337474467},{"x":1025.884577265093,"y":621.4621262390615},{"x":1063.0000404953037,"y":572.2052555401924},{"x":1036.3032938334925,"y":563.1584953649941},{"x":930.7473894593768,"y":546.1238064459676},{"x":795.0822941217764,"y":509.39349458056455},{"x":702.2821682830553,"y":481.85853314533796},{"x":624.2546120362027,"y":460.3632499742514},{"x":585.4943053932211,"y":420.52025510301894},{"x":556.906859339322,"y":411.84995352102385},{"x":526.5729889378939,"y":373.0875178601242},{"x":520.0334121169637,"y":369.85570440886715},{"x":505.9150751999381,"y":366.0786066299345},{"x":490.1328620133135,"y":378.5852590626445}
]);
  const [hasil, setHasil] = useState([])

  const data_new = [];

  // membuat data menjadi array
  const arr = data.map((obj) => {
    data_new.push([Math.ceil(obj.x), Math.ceil(obj.y)]);
  })

  let titik = [];
  // let K = 80

for (let i = 0; i <= 4000; i += 50) {
  titik.push([i, i + 50]);
}

// console.log(titik.length)

  // membuat centeroid agar bisa mengetahui dimana aja titik yang terdekat
  // let centers = [
  //   [100, 500],
  //   [510, 1000],
  //   [1100, 1500],
  //   [1510, 2000],
  //   [2110, 3000],

  // ];

  // proses k means

  let ans = kmeans(data_new, titik.length, { initialization: titik });
//   console.log(ans.clusters);

  const data_cluster = []
  // membuat setiap data_new di tambahkan dengan clusters
  for(let i = 0; i < ans.clusters.length; i++){
    const arr = data_new[i];
    arr.push(ans.clusters[i])
    data_cluster.push(arr);
  } 

  // sorting data dari yang terkecil
  const sortedData = data_cluster.sort((a, b) => a[a.length - 1] - b[b.length - 1]);
  // console.log(sortedData, ini data urutan);

  const groupedData = {};

  sortedData.forEach(subarray => {
    const lastValue = subarray[subarray.length - 1];
    if (groupedData[lastValue]) {
      groupedData[lastValue].push(subarray);
    } else {
      groupedData[lastValue] = [subarray];
    }
  });
  
  // console.log(groupedData);
  const mergedData = Object.values(groupedData).reduce((acc, curr) => acc.concat(curr), []);

  console.log(mergedData);

 

  return (
    <div>
      <h1>K means</h1>
      {/* <div>
        {hasil.map((index, data) => <>
        <div>
          {index} : {data}
        </div>
        
        </> )}
      </div> */}
    </div>
  );
}

export default CMeansClustering;
